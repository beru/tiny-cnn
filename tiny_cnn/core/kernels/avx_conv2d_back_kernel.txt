
blendps
_mm_blend_ps

andps
_mm_and_ps

------------------------
3x3

S
    0123 4567

W
    012- ----
    012- ----
    012- ----

D
    0123 4567
    0123 4567
    0123 4567

----
1 block = 6 pixels

S
    0123 45--

W
    0000 0000
    -111 1111
    --22 2222

I
  S 0123 45--
  W 0000 0000
    
  S -012 345-
  W -111 1111
     
  S --01 2345
  W --22 2222

----
1 block = 8 pixels

S
    0123 4567

W
    0000 0000
    1111 1111
    2222 2222

I
  S 0123 4567
  W 0000 0000
    
  S -012 3456 7
  W -111 1111 1
     
  S --01 2345 67
  W --22 2222 22

------------------
5x5

S
    0123 4567

W
    0123 4---
    0123 4---
    0123 4---
    0123 4---
    0123 4---
    
D
    0123 4567
    0123 4567
    0123 4567
    0123 4567
    0123 4567

----
1 block = 4 pixels

current implementation

    Source
        0123 0123
        
    Weights
      prepare shifted weights
    
        0123 4---
        -012 34--
        --01 234-
        ---0 1234
        
    Intermediate
    
      permute source
      
      S 0000 0000
      S 1111 1111
      S 2222 2222
      S 3333 3333
      
      multiply
      
      S 0000 0000
      W 0123 4---
      
      S 1111 1111
      W -012 34--
      
      S 2222 2222
      W --01 234-
      
      S 3333 3333
      W ---0 1234

another idea 1

    Src
        0123 0123
        
    Weights
        0000 4444
        1111 2222 
        3333 

    Intermediate
    
      multiply
    
      S 0123 0123
      W 0000 4444
      
      S 0123 0123
      W 1111 2222

      S 0123
      W 3333
      
      Å´
      
      shift
      
      S 0123 0123
      W 0000 4444
      
      S -012 3---
      W -111 1---
      
      S --01 23--
      W --22 22--

      S ---0 123-
      W ---3 333-

another idea 2

    Src
        0123 0123
        -012 3---
        --01 23--
        ---0 123-
        
    Weights
    
      prepare shifted weights
    
        0000 4444
        -111 1---
        --22 22--
        ---3 333-

    Intermediate
    
      load source
        0123 0123
        -012 3---
        --01 23--
        ---0 123-
    
      multiply S * W
    
      S 0123 0123
      W 0000 4444

      S -012 3---
      W -111 1---

      S --01 23--
      W --22 22--

      S ---0 123-
      W ---3 333-

----
1 block = 8 pixels

Source
    0123 4567
    
Weights
    0000 0000
    1111 1111
    2222 2222
    3333 3333
    4444 4444
    
Intermediate
    S  0123 4567
    
    W  0000 0000
    W  1111 1111
    W  2222 2222
    W  3333 3333
    W  4444 4444

    Å´

    S  0123 4567
    W  0000 0000

    S  0123 4567
    W  1111 1111

    S  0123 4567
    W  2222 2222

    S  0123 4567
    W  3333 3333

    S  0123 4567
    W  4444 4444

    Å´

    S  0123 4567
    W  0000 0000

    S  -012 3456 7---
    W  -111 1111 1---

    S  --01 2345 67--
    W  --22 2222 22--

    S  ---0 1234 567-
    W  ---3 3333 333-

    S  ---- 0123 4567
    W  ---- 4444 4444

----
another idea

    Source
        0123 0123
        4567 4567
        
    Weights
      prepare shifted weights
    
        0123 4---
        -012 34--
        --01 234-
        ---0 1234
        
    Intermediate
    
      permute source
      
      S 0000 0000
      S 1111 1111
      S 2222 2222
      S 3333 3333

      S 4444 4444
      S 5555 5555
      S 6666 6666
      S 7777 7777
      
      multiply
      
      S 0000 0000
      W 0123 4---
      
      S 1111 1111
      W -012 34--
      
      S 2222 2222
      W --01 234-
      
      S 3333 3333
      W ---0 1234

      S      4444 4444
      W      0123 4---
      
      S      5555 5555
      W      -012 34--
      
      S      6666 6666
      W      --01 234-
      
      S      7777 7777
      W      ---0 1234
